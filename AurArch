#!/bin/bash

# Function to clone the AUR repository
clone_repo() {
    repo_url="$1"
    AUR_Downloads="$2"

    # Clone the repository
    git clone "$repo_url" "$AUR_Downloads"
}

# Function to clone the AUR repository and install the package
clone_and_install() {
    repo_url="$1"
    AUR_Downloads="$2"

    # Clone the repository
    git clone "$repo_url" "$AUR_Downloads"

    # Install the AUR package
    cd "$AUR_Downloads" || exit 1
    makepkg -si
}

# Get the current username
current_user=$(whoami)

# Create the AUR_Downloads directory if it doesn't exist
mkdir -p "$HOME/AUR_Downloads"

# Greet the user with a custom welcome screen (centered)
whiptail --title "AUR Downloader" --msgbox --scrolltext "\
##################################################################### Hello $current_user #####################################################################

What are we doing today?

Bar 1: Just Cloning For Now
1
2
3
4
5
6
7
8
9
10

Bar 2: I'll Be Cloning and Installing
1
2
3
4
5
6
7
8
9
10" 25 80 0

# Greet the user and provide options
options=$(whiptail --title "AUR Downloader" --menu "What would you like to do today?" 15 60 2 "Just Cloning" "" "Clone & Install" "" 3>&1 1>&2 2>&3)

# Get AUR repository URL and chosen directory from user
aur_repo_url=$(whiptail --inputbox "Enter AUR Repository URL:" 10 60 --title "AUR Downloader" 3>&1 1>&2 2>&3)
AUR_Downloads=$(whiptail --title "Select AUR_Downloads Directory" --file-selection --directory --title "AUR Downloader" --default-item "$HOME/AUR_Downloads" 3>&1 1>&2 2>&3)

# Verify the input is not empty
if [ -z "$options" ] || [ -z "$aur_repo_url" ] || [ -z "$AUR_Downloads" ]; then
    whiptail --msgbox "Options, repository URL, and download directory cannot be empty. Exiting." 10 60 --title "Error" --exitstatus 1
    exit 1
fi

# Process user's choice
case $options in
    "Just Cloning")
        # Clone the repository
        clone_repo "$aur_repo_url" "$AUR_Downloads"
        whiptail --msgbox "Repository cloned successfully." 10 60 --title "Success"
        ;;
    "Clone & Install")
        # Clone the repository and install the AUR package
        clone_and_install "$aur_repo_url" "$AUR_Downloads"

        # Ask the user if they want to copy and link the folder in .config
        whiptail --yesno "Hello! Would you like to copy and link this folder in your .config?" 10 60 --title "Confirmation"
        response=$?

        # Interpret the user's response
        if [ $response -eq 0 ]; then
            cp -r "$AUR_Downloads" "$HOME/.config/"
            ln -s "$HOME/.config/$(basename "$aur_repo_url" .git)" "$HOME/"
            whiptail --msgbox "Folder copied and linked successfully." 10 60 --title "Success"
        else
            whiptail --msgbox "Folder not copied or linked." 10 60 --title "Information"
        fi
        ;;
    *)
        whiptail --msgbox "Invalid option. Exiting." 10 60 --title "Error"
        exit 1
        ;;
esac
